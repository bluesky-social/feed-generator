/// <reference types="node" />
import { IncomingMessage } from 'http';
import express from 'express';
import zod from 'zod';
import { ResponseType } from '@atproto/xrpc';
export declare type Options = {
    validateResponse?: boolean;
    payload?: {
        jsonLimit?: number;
        blobLimit?: number;
        textLimit?: number;
    };
};
export declare type UndecodedParams = typeof express.request['query'];
export declare type Primitive = string | number | boolean;
export declare type Params = Record<string, Primitive | Primitive[] | undefined>;
export declare const handlerInput: zod.ZodObject<{
    encoding: zod.ZodString;
    body: zod.ZodAny;
}, "strip", zod.ZodTypeAny, {
    body?: any;
    encoding: string;
}, {
    body?: any;
    encoding: string;
}>;
export declare type HandlerInput = zod.infer<typeof handlerInput>;
export declare const handlerAuth: zod.ZodObject<{
    credentials: zod.ZodAny;
    artifacts: zod.ZodAny;
}, "strip", zod.ZodTypeAny, {
    credentials?: any;
    artifacts?: any;
}, {
    credentials?: any;
    artifacts?: any;
}>;
export declare type HandlerAuth = zod.infer<typeof handlerAuth>;
export declare const handlerSuccess: zod.ZodObject<{
    encoding: zod.ZodString;
    body: zod.ZodAny;
}, "strip", zod.ZodTypeAny, {
    body?: any;
    encoding: string;
}, {
    body?: any;
    encoding: string;
}>;
export declare type HandlerSuccess = zod.infer<typeof handlerSuccess>;
export declare const handlerError: zod.ZodObject<{
    status: zod.ZodNumber;
    error: zod.ZodOptional<zod.ZodString>;
    message: zod.ZodOptional<zod.ZodString>;
}, "strip", zod.ZodTypeAny, {
    error?: string | undefined;
    message?: string | undefined;
    status: number;
}, {
    error?: string | undefined;
    message?: string | undefined;
    status: number;
}>;
export declare type HandlerError = zod.infer<typeof handlerError>;
export declare type HandlerOutput = HandlerSuccess | HandlerError;
export declare type XRPCHandler = (ctx: {
    auth: HandlerAuth | undefined;
    params: Params;
    input: HandlerInput | undefined;
    req: express.Request;
    res: express.Response;
}) => Promise<HandlerOutput> | HandlerOutput | undefined;
export declare type XRPCStreamHandler = (ctx: {
    auth: HandlerAuth | undefined;
    params: Params;
    req: IncomingMessage;
}) => AsyncIterable<unknown>;
export declare type AuthOutput = HandlerAuth | HandlerError;
export declare type AuthVerifier = (ctx: {
    req: express.Request;
    res: express.Response;
}) => Promise<AuthOutput> | AuthOutput;
export declare type StreamAuthVerifier = (ctx: {
    req: IncomingMessage;
}) => Promise<AuthOutput> | AuthOutput;
export declare type XRPCHandlerConfig = {
    auth?: AuthVerifier;
    handler: XRPCHandler;
};
export declare type XRPCStreamHandlerConfig = {
    auth?: StreamAuthVerifier;
    handler: XRPCStreamHandler;
};
export declare class XRPCError extends Error {
    type: ResponseType;
    errorMessage?: string | undefined;
    customErrorName?: string | undefined;
    constructor(type: ResponseType, errorMessage?: string | undefined, customErrorName?: string | undefined);
    get payload(): {
        error: string | undefined;
        message: string | undefined;
    };
    get typeName(): string | undefined;
    get typeStr(): string | undefined;
    static fromError(error: unknown): XRPCError;
}
export declare function isHandlerError(v: unknown): v is HandlerError;
export declare class InvalidRequestError extends XRPCError {
    constructor(errorMessage?: string, customErrorName?: string);
}
export declare class AuthRequiredError extends XRPCError {
    constructor(errorMessage?: string, customErrorName?: string);
}
export declare class ForbiddenError extends XRPCError {
    constructor(errorMessage?: string, customErrorName?: string);
}
export declare class InternalServerError extends XRPCError {
    constructor(errorMessage?: string, customErrorName?: string);
}
export declare class UpstreamFailureError extends XRPCError {
    constructor(errorMessage?: string, customErrorName?: string);
}
export declare class NotEnoughResoucesError extends XRPCError {
    constructor(errorMessage?: string, customErrorName?: string);
}
export declare class UpstreamTimeoutError extends XRPCError {
    constructor(errorMessage?: string, customErrorName?: string);
}
export declare class MethodNotImplementedError extends XRPCError {
    constructor(errorMessage?: string, customErrorName?: string);
}
